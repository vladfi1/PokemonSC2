import a.natives.trigger;
import a.natives.point;
import a.natives.timer;

include "species.a"
include "player.a"


static {
    //initPlayers(2);
    //createBoard(2);

    VisEnable(c_visTypeFog, false);

    //CameraPan(1, Point(50, 50), 0, 0, 0, false);

    //unit u = unit.create("RentalCenters", 0, 1, Point(40, 40), 0);

    //point.fromId doesn't work :(
    //createUnitHelper("Tower", 7, point.fromId(1));
    //createUnitHelper("Tower", 7, point.fromId(2));
    //createUnitHelper("Tower", 1, point.fromId(3));
    //createUnitHelper("Tower", 1, point.fromId(4));

    trigger.create(createUnitChat.name).addEventChatMessage(c_playerAny, "", false);

    //trigger.create(print5.name).addEventUnitAbility(u.getUnitRef(), AbilityCommand("Print", 0), -3, false);

    timer t = timer.create();
    t.start(15, true, timer.GAME_TIME);

    trigger.create(makeWave.name).addEventTimer(t);
    
    /*
    for (int i=1; i<=3; ++i) {
        for (int j=i+1; j<=3; ++j) {
            libNtve_gf_SetAlliance(i, j, 2);
            libNtve_gf_SetAlliance(i+3, j+3, 2);
        }
        libNtve_gf_SetAlliance(i, 7, 2);
        libNtve_gf_SetAlliance(i+3, 8, 2);
    }*/
}

bool createUnitChat(bool b1, bool b2) {
    string chat = EventChatMessage(false);
    
    PokemonSpecies species = PokemonSpecies.fromString(chat);
    if (species == null) {
        System.print("Species " + chat + " does not exist!");
        return false;
    }
    
    int player = 1;
    Trainer trainer = Trainer.getTrainer(player);
    //System.debug("Team name: " + trainer.team.name);
    //System.debug((string) Trainer.trainers.size());
    trainer.addPokemon(species);
    return true;
}

/*
public bool print5(bool a, bool b) {
    System.debug("5");
    return false;
}*/

//LeaderBoard lb;
//int[12] lives;

/////  logistic methods
/*
public void initPlayers(int players) {
    for (int i=0; i<players; i+=1) {
        lives[i] = 20;
    }
}*/

/////  leaderboard methods
/*
public LeaderBoard createBoard(int players) {
    lb = LeaderBoard.create(2, players, "Lives", color.create(100, 0, 0, 100));

    for (int i=0; i<players; i+=1) {
        lb.setItemText(1, i+1, "tmp");
        lb.setItemText(2, i+1, (string)lives[i]);
    }
    return lb;    
}*/

bool makeWave(bool b1, bool b2) {
    waveHelper(Team.left, 1);
    waveHelper(Team.right, -1);
    return true;
}

void waveHelper(Team team, int dx) {
    int spawn_dx = 18 * dx;
    int attack_dx = 100 * dx;

    Iterator<Trainer> trainers = team.trainers.getIterator();
    
    while(trainers.hasNext()) {
        Trainer trainer = trainers.next();
        Iterator<Pokemon> pokemon = trainer.pokemon.getIterator();
        
        while(pokemon.hasNext()) {
            Pokemon p = pokemon.next();
            
            point spawn = p.getUnit().getPosition().translateXY(spawn_dx, 0);
            Pokemon clone = p.clone(spawn);
            
            point attack = spawn.translateXY(attack_dx, 0);
            order o = OrderTargetingPoint(AbilityCommand("attack", 0), attack);
            UnitIssueOrder(clone.getUnit(), o, c_orderQueueAddToEnd);
        }
        
        delete pokemon;
    }
    
    delete trainers;
}

/////  wave methods

/*public void setMonsterPath(unit u) {
    for (int i=2; i<=6; i+=1) {
        order o = OrderTargetingPoint(AbilityCommand("move", 0), point.fromId(i));
        UnitIssueOrder(u, o, c_orderQueueAddToEnd);
    }
}*/

/*public void createWave(string s, int number) {
    for (int i=0; i<number; i+=1) {
        unit u = createUnit(s, WAVE_START_POINT);
        TriggerAddEventUnitDamaged(TriggerCreate(damageUnit.name), u.getUnitRef(), c_unitDamageTypeAny, c_unitDamageEither, null);
        setMonsterPath(u);

        if (i < number-1) {
            Wait(1, c_timeGame);
        }
    }
}*/

